---
title: "大量カラムでも楽々EDA！sweetvizの欠点をスクレイピングでカバーする方法"
emoji: "📚"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["EDA", "探索的データ分析", "sweetviz", "スクレイピング", "BeautifulSoup"]
published: false
---
## はじめに
こんにちは、SE出身の駆け出しデータサイエンティストの「マチ」です。最近、**カラム数が100を超える構造化データ**の分析業務に取り組む機会がありました。正直、「この量を1つ1つ見るのは面倒だな…」と感じて、最初の一歩がなかなか進まなかったのが本音です。

そこで、「**なるべく時間をかけずに、効率よくEDA（探索的データ分析）を済ませたい**」と考え、実際に活用して効果的だった方法を備忘録として残します。キーワードは 「**sweetviz × スクレイピング**」 です。



## よく使われるEDAライブラリの比較
まずは、Pythonで使える代表的なEDA自動化ライブラリを簡単に紹介します。なお、出力例ではkaggleから取得できる[「日本の消費者物価指数」のデータ](https://www.kaggle.com/datasets/yutodennou/consumer-price-index-of-japan-by-2022)を使用しています。

:::details ydata-profiling（旧 pandas_profiling）
- **特徴**
pandasのDataFrameを渡すだけで、統計要約・欠損値・分布・相関などを自動出力。
- **メリット**
レポートが非常に網羅的で、インタラクティブなUIも使いやすい。
- **デメリット**
データ量やカラム数が多いと、非常に重くなり処理が遅い。
- **出力例**
- **実行コード例**
```py:ipynbファイル（実行時の所要時間：★分程度）
# !pip install ydata_profiling            # 必要に応じてインストール
# !pip install setuptools                 # 必要に応じてインストール

import pandas as pd
from ydata_profiling import ProfileReport

data = pd.read_csv('./data/2022_Japan_CPI_middleLevelClassificationIndex.csv')	# 79カラム
profile = ProfileReport(data, title="Profiling Report")
# profile.to_notebook_iframe()            					# Jupyter Notebookのセル内に、プロファイリングレポートを iframe 形式で表示
profile.to_file("./ydata_profiling.html")					# ファイル出力
```
- **出力されるファイルイメージ**
※[ソースはこちら](★★★)
![](/images/util/dummy_black.png =150x)
:::



:::details AutoViz

- **特徴**
コード1行でグラフ多数を自動生成。ターゲット変数指定による分析も可能。
- **メリット**
データ前処理や前提知識なしでEDAを可視化できる。
- **デメリット**
Pythonのバージョン依存が強く、最新版での動作が不安定なことも
- **実行コード例**
```py:ipynbファイル（実行時の所要時間：★分程度）
★★★
```
- **出力されるファイルイメージ**
※[ソースはこちら](★★★)
![](/images/util/dummy_black.png =150x)
:::



:::details sweetviz
- **特徴**
訓練データとテストデータの比較や、目的変数との関連性をビジュアルで出力。
- **メリット**
色味やデザインが見やすく、比較モードが便利。セットアップも簡単。
- **デメリット**
カラム数が多すぎると、「Associations」の図のテキストが潰れて読めない
- **実行コード例**
```py:ipynbファイル（実行時の所要時間：★分程度）
★★★
```
- **出力されるファイルイメージ**
※[ソースはこちら](★★★)
![](/images/util/dummy_black.png =150x)

:::message
**文字化けやエラーは以下で解消できる可能性があります。**
- **日本語の文字化けを解消する**
```py:ipynbファイル
★★★
```
<br>
- **エラーと解消方法**
   - エラー
XXXXX
   - 解消方法：相関関係の解析を明示的に有効化する
```py:ipynbファイル
★★★
```
:::



## sweetvizの弱点を補う方法：HTMLのスクレイピング
sweetvizは、動作が軽い点や比較ができる点が魅力的です。しかし、「Associations」の図は**カラム数が多くなると文字が小さくなり見づらくなります**。ブラウザの縮尺を変えて図を大きくできないか試してみたり、htmlの要素を開発者ツールで修正しようとしてみたりしましたが、いずれも有効ではありませんでした。そこで、「**sweetvizが出力したHTMLレポートをスクレイピングして、要素間の相関を別途整理する**」という方法を試してみました。

### 実施概要
![](/images/util/dummy_black.png =150x)
1. sweetvizで出力されたHTMLファイルをBeautifulSoupで読み込み
2. 「Associations」に相当する要素を解析し、変数ペアと相関スコアを抽出
3. pandasのDataFrameで整理し、相関の強い順に並べて確認

この方法により、視覚的に見づらくなった相関情報をテーブル形式で素早く把握でき、次の分析アクションにも移りやすくなりました。

### コードと結果の出力イメージ
XXXXX

## さいごに
大量カラムのEDAは、着手のハードルが高く感じがちですが、「ライブラリ選定」と「少しの工夫（スクレイピング）」 を組み合わせることで、ある程度楽にこなせるようになります。sweetviz単体でも便利ですが、「もう一歩踏み込んで効率化したい」と思った方の参考になれば幸いです。

